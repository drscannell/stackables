<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>stackables</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<link rel="apple-touch-icon" href="/icons/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png" />
<style>
section {text-align:center;}
form {display:inline-block;text-align:right;}
div {margin-bottom:10px;}
#error {color:red;}
</style>
</head>
<body>
<section>
	<h1>stackables login</h1>

	<form>
		<h2>login</h2>
		<div>
			email: 
			<input id="login-email" type="text" autocapitalize="off" autocorrect="off" autofocus="autofocus" />
		</div>
		<div>
			pass: 
			<input id="login-password" type="password" />
		</div>
		<input id="login-button" type="button" value="login" />
	</form>
</section>
<section>
	<form>
		<h2>signup</h2>
		<div>
			email: 
			<input id="signup-email" type="text" autocapitalize="off" autocorrect="off" autofocus="autofocus" />
		</div>
		<div>
			pass: 
			<input id="signup-password" type="password" />
		</div>
		<input id="signup-button" type="button" value="signup" />
	</form>

	<div id="error">&#x00A0;</div>
</section>

<script type="text/javascript" src="dependencies/jquery-2.0.3.js"></script>
<script>
var errordisplay;
function main(){
	errordisplay = $('#error');
	$('#login-button').on('click', function(event) {
		console.log('login');
		$.post('/login', {
			'name':'test2',
			'password':'test3'
			}, function(data, textStatus, jqXHR) {
			console.log(textStatus);
			console.log(data);
			
			//window.location = '/';
		});

	});
	$('#signup-button').on('click', function(event) {
		console.log('signup');

	});
	/*
	document.getElementById('password').addEventListener('keypress',function(event){
		if ( event.keyCode == 13 ) { // enter key
			sendRequest();
		}
	});
	document.getElementById('name').addEventListener('keypress',function(event){
		if ( event.keyCode == 13 ) { // enter key
			sendRequest();
		}
	});
	*/
}
function sendRequest() {
	console.log('sending login attempt');
	var xhr = new XMLHttpRequest();
	xhr.open("post", "login", true);
	var name = document.getElementById('name').value;
	var password = document.getElementById('password').value;
	//password = md5(password); // hashes password before sending (stop doing this if switch to HTTPS)
	console.log(name + '/' + password);
	var formData = new FormData();
	formData.append('name',name);
	formData.append('password',password);
	xhr.addEventListener('readystatechange',function(){
		if ( xhr.readyState === 4 ) {
			var response = JSON.parse(xhr.responseText);
			console.log(response);
			console.log(xhr.status);
			if ( xhr.status === 200 ) {
				window.location = '/';
			} else if ( xhr.status === 404 ) {
				console.log('server not found');
				errordisplay.innerHTML = 'server not found';
			} else if ( xhr.status === 401 ) {
				console.log('server error');
				errordisplay.innerHTML = response.error;
			}
		}
	},false);
	xhr.send(formData);
}
window.addEventListener('load',main,false);
</script>

</body>
</html>
